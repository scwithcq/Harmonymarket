// File: entry/src/main/ets/pages/Users/Home/HomePage.ets
import router from '@ohos.router';
import { promptAction } from '@kit.ArkUI';
// åæœŸåœ¨è¿™é‡Œè®¾ç½®ç»Ÿä¸€é¢œè‰²
import { app_color } from '../../../utils/Colors'
import { SearchParams } from '../../../common/Params/SearchParams/SearchParams';

// æ–‡ç« æ•°æ®å®šä¹‰
export interface Article {
  image: string
  title: string
  test: string
}

// æ–‡ç« æ•°æ® -- é™æ€
export const ArticleList: Article[] = [
  {
    image: 'https://picsum.photos/200/120?random=4',
    title: 'å®«ä¿é¸¡ä¸',
    test: 'é²œå«©é¸¡è‚‰ä¸èŠ±ç”Ÿçš„å®Œç¾æ­é…'
  },
  {
    image: 'https://picsum.photos/200/120?random=5',
    title: 'è¥¿çº¢æŸ¿ç‚’è›‹',
    test: 'å®¶å¸¸å¿…å¤‡ï¼Œç®€å•ç¾å‘³'
  },
  {
    image: 'https://picsum.photos/200/120?random=6',
    title: 'éº»å©†è±†è…',
    test: 'å·å‘³ä»£è¡¨ï¼Œé¦™éº»ä¸‹é¥­'
  },
  {
    image: "https://picsum.photos/200/120?random=11",
    title: "ç³–é†‹é‡Œè„Š",
    test: "é…¸ç”œé…¥è„†ï¼Œè€å°‘çš†å®œ"
  },
  {
    image: "https://picsum.photos/200/120?random=22",
    title: "æ¸…è’¸é²ˆé±¼",
    test: "é²œå«©æ— è…¥å‘³ï¼Œå¹¿å¼ç»å…¸"
  },
  {
    image: "https://picsum.photos/200/120?random=33",
    title: "å®«ä¿é¸¡ä¸",
    test: "éº»è¾£å¾®ç”œï¼ŒèŠ±ç”Ÿè„†é¦™"
  },
  {
    image: "https://picsum.photos/200/120?random=44",
    title: "çº¢çƒ§è‚‰",
    test: "è‚¥è€Œä¸è…»ï¼Œå…¥å£å³åŒ–"
  },
  {
    image: "https://picsum.photos/200/120?random=55",
    title: "è¥¿çº¢æŸ¿é¸¡è›‹",
    test: "å®¶å¸¸å¿«æ‰‹èœï¼Œç™¾åƒä¸åŒ"
  }
]


@Component
export struct HomePage {
  // è¿™é‡Œåšé˜²æ­¢è¢«å¯¼èˆªæ é®æŒ¡
  readonly TABBAR_HEIGHT: number = 350
  @State articles: Article[] = ArticleList
  @State productName: string = '';
  @State cartVisible: Visibility = Visibility.Visible
  // å£°æ˜ pathStack
  pathStack: NavPathStack = new NavPathStack();

  // åœ¨é¡µé¢ ready æ—¶è·å–ä¸Šå±‚ NavDestination çš„ pathStack
  onReady(context: NavDestinationContext) {
    this.pathStack = context.pathStack;
  }

  build() {
    Scroll() {
      Column() {
        // é¡¶éƒ¨æœç´¢æ 
        Row() {
          // ç”¨æˆ·å¤´åƒ
          // Image('https://picsum.photos/40/40')
          //   .width(44)
          //   .height(44)
          //   .borderRadius(22)
          //   .shadow({radius: 4, color: 'rgba(0,0,0,0.08)', offsetX: 0, offsetY: 2})

          // æœç´¢æ¡†
          Row() {
            Image($r('app.media.ic_search'))
              .width(16)
              .height(16)
              .margin({ right: 8 })
            TextInput({
              placeholder: 'è¯·è¾“å…¥å•†å“åç§°'
            })
              .backgroundColor('#FEC4DF')
              .width('70%')
              .onChange((value: string) => {
                this.productName = value;
              })// Text('æœç´¢èœè°± / é£Ÿæ / å•†æˆ·...')
              .fontSize(14)
              .fontColor('#9E9E9E')
            Button('æœç´¢')
              .width('20%')
              .height(40)
              .margin({ left: 10 })
              .backgroundColor('#4CAF50')
              .fontColor('#FFFFFF')
              .onClick(() => {
                if (!this.productName?.trim()) {
                  promptAction.showToast({ message: 'è¯·è¾“å…¥å•†å“åç§°' });
                  return;
                }

                // const params = new SearchParams(this.productName);
                router.pushUrl({
                  url: 'pages/Users/Home/SearchProductPage',
                  params: { keyword: this.productName, animateCart: true }
                });
              });


          }
          .width('100%')
          .height(44)
          // .backgroundColor('#F8F9FA')
          .borderRadius(20)
          .margin({ left: 12 })
          .justifyContent(FlexAlign.SpaceBetween)
          .padding({ left: 16 })
          .border({ width: 1, color: '#E9ECEF' })
        }
        .backgroundColor('#FEC4DF')
        .padding({
          right: 10,
          top: 10,
          bottom: 10
        })
        .height(64)
        .justifyContent(FlexAlign.SpaceBetween)

        // ä»Šæ—¥æ¨èæ ‡é¢˜
        Row() {
          Text('ğŸ³ ä»Šæ—¥æ¨è')
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
          Blank()
          Text('æ›´å¤š >')
            .fontSize(14)
            .fontColor('#888')
        }
        .backgroundColor('#27AE60')
        .width('100%')
        .padding({
          left: 16,
          right: 16,
          top: 10,
          bottom: 10
        })

        // ä»Šæ—¥æ¨èæ¨ªå‘å¡ç‰‡
        Scroll() {
          Row() {
            Column() {
              Image('https://picsum.photos/200/120?random=1')
                .width(150)
                .height(110)
                .borderRadius(12)
              Text('å®«ä¿é¸¡ä¸')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })
              Text('é²œå«©é¸¡è‚‰ä¸èŠ±ç”Ÿçš„å®Œç¾æ­é…')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
            .margin({ right: 12 })

            Column() {
              Image('https://picsum.photos/200/120?random=2')
                .width(150)
                .height(110)
                .borderRadius(12)
              Text('è¥¿çº¢æŸ¿ç‚’è›‹')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })
              Text('å®¶å¸¸å¿…å¤‡ï¼Œç®€å•ç¾å‘³')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
            .margin({ right: 12 })

            Column() {
              Image('https://picsum.photos/200/120?random=9')
                .width(150)
                .height(110)
                .borderRadius(12)

              Text('éº»å©†è±†è…')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })

              Text('éº»è¾£é²œé¦™ï¼Œä¸‹é¥­ç¥å™¨')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
            .margin({ right: 12 })

            Column() {
              Image('https://picsum.photos/200/120?random=7')
                .width(150)
                .height(110)
                .borderRadius(12)

              Text('ç³–é†‹é‡Œè„Š')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })

              Text('é…¸ç”œå¼€èƒƒï¼Œè€å°‘çš†å®œ')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
            .margin({ right: 12 })

            Column() {
              Image('https://picsum.photos/200/120?random=5')
                .width(150)
                .height(110)
                .borderRadius(12)

              Text('è’œè“‰è¥¿å…°èŠ±')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })

              Text('æ¸…çˆ½ä½è„‚ï¼Œååˆ†é’Ÿä¸Šæ¡Œ')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
            .margin({ right: 12 })

            Column() {
              Image('https://picsum.photos/200/120?random=3')
                .width(150)
                .height(110)
                .borderRadius(12)
              Text('éº»å©†è±†è…')
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .margin({ top: 8 })
              Text('å·å‘³ä»£è¡¨ï¼Œé¦™éº»ä¸‹é¥­')
                .fontSize(12)
                .fontColor('#888')
                .margin({ top: 4 })
            }
          }
          .padding({ left: 16, right: 16 })
        }
        .scrollable(ScrollDirection.Horizontal)
        .scrollBar(BarState.Off)
        .height(200)
        .padding({ top: 12 })

        // AIæ™ºèƒ½æ¨èæ ‡é¢˜
        Row() {
          Text('ğŸ¤– AI æ™ºèƒ½æ¨è')
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
          Blank()
          Text('æ¢ä¸€æ‰¹')
            .fontSize(14)
            .fontColor('#888')
        }
        .backgroundColor('#27AE60') //é«˜é¥±å’Œåº¦æš–ç»¿è‰²
        .width('100%')
        .padding({
          left: 16,
          right: 16,
          top: 10,
          bottom: 10
        })

        // èœè°±åˆ—è¡¨
        List() {
          ForEach(this.articles, (item: Article) => {
            ListItem() {
              Row() {
                Image(item.image.trim())
                  .width(106)
                  .height(82)
                  .borderRadius(8)

                Column() {
                  Text(item.title)
                    .fontSize(16)
                    .fontWeight(FontWeight.Bold)
                  Text(item.test)
                    .fontSize(12)
                    .fontColor('#666')
                    .margin({ top: 4 })
                }
                .alignItems(HorizontalAlign.Start)
                .margin({ left: 12 })
                .layoutWeight(1)
              }
              .width('100%')
              .padding({
                left: 16,
                right: 16,
                top: 8,
                bottom: 8
              })
            }
          })
        }
        .padding({ bottom: this.TABBAR_HEIGHT })

      }
      .width('100%')
      .height('100%')
      .backgroundColor('#F8F9FA')
    }

  }

  // è®¾ç½®ä¸€ä¸ªæœç´¢æ¡†ç‚¹å‡»æœç´¢è·³è½¬åˆ°æ–°é¡µé¢çš„æ–¹æ³•
  goToSearchPage() {
    if (!this.productName || this.productName.trim() === '') {
      promptAction.showToast({ message: 'è¯·è¾“å…¥å•†å“åç§°' });
      return
    }

    // ä½¿ç”¨ router.push è·³è½¬åˆ°ç»“æœé¡µï¼Œå¹¶ä¼ é€’å‚æ•°
    router.pushUrl({
      url: 'pages/Users/Home/SearchProductPage',
      params: {
        productName: this.productName
      }
    })
  }
}
