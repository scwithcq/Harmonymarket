import { prompt } from "@kit.ArkUI"

import {MqttClientPanel} from "../../../utils/MqttClientPanel"

@Builder
export function MerchantHomePageBuilder() {
  MerchantHomePage()
}

@Component
export struct MerchantHomePage {
  @State pageStack: NavPathStack = null!
  @State selectedTab: string = 'æ‹ç…§ä¸Šä¼ '
  @State capturedImage: Resource | null = null // æ¨¡æ‹Ÿç”¨ Resource ç±»åž‹

  // æ¨¡æ‹Ÿæ‹ç…§
  takePhoto() {
    prompt.showToast({ message: 'æ¨¡æ‹Ÿæ‹ç…§æˆåŠŸï¼' })
    this.capturedImage = $r('app.media.recommend4')
  }

  // è¿”å›žåˆ°æ‹ç…§ä¸Šä¼ 
  backToCamera() {
    this.selectedTab = 'æ‹ç…§ä¸Šä¼ '
  }

  build() {
    NavDestination() {
      Column({ space: 15 }) {

        // é¡¶éƒ¨æ ‡é¢˜åŒº
        Row(){

        }
        Row() {
          if (this.selectedTab !== 'æ‹ç…§ä¸Šä¼ ') {
            // âœ… å½“ä¸æ˜¯æ‹ç…§ä¸Šä¼ é¡µæ—¶æ˜¾ç¤ºè¿”å›žæŒ‰é’®
            Button('â† è¿”å›žæ‹ç…§ä¸Šä¼ ')
              .onClick(() => this.backToCamera())
              .fontSize(14)
              .backgroundColor('#E0E0E0')
              .borderRadius(8)
              .padding(6)
          } else {
            Blank() // å ä½ï¼Œä¿æŒå¸ƒå±€ç¨³å®š
          }

          Text('å•†å®¶å·¥ä½œå°')
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 5 })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceBetween)
        .padding({ left: 15, right: 15, top: 10 })

        // ä¸­é—´ä¸»è¦å†…å®¹åŒº
        if (this.selectedTab === 'æ‹ç…§ä¸Šä¼ ') {
          this.buildCameraPage()
        } else if (this.selectedTab === 'å•†å“ç®¡ç†') {
          this.buildPlaceholderPage('å•†å“ç®¡ç†')
        } else if (this.selectedTab === 'è®¢å•ç®¡ç†') {
          this.buildPlaceholderPage('è®¢å•ç®¡ç†')
        } else {
          this.buildPlaceholderPage('æˆ‘çš„')
        }

        // åº•éƒ¨å¯¼èˆªæ 
        Row({ space: 20 }) {
          this.buildNavButton('æ‹ç…§ä¸Šä¼ ', 'ðŸ“¸')
          this.buildNavButton('å•†å“ç®¡ç†', 'ðŸ›’')
          this.buildNavButton('è®¢å•ç®¡ç†', 'ðŸ“¦')
          this.buildNavButton('æˆ‘çš„', 'ðŸ‘¤')
        }
        .justifyContent(FlexAlign.SpaceEvenly)
        .padding(10)
        .backgroundColor(Color.White) // åº•éƒ¨å¯¼èˆªèƒŒæ™¯ç™½è‰²
      }
      .width('100%')
      .height('100%')
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .onReady((context: NavDestinationContext) => {
      this.pageStack = context.pathStack
    })
  }

  // æ‹ç…§ä¸Šä¼ é¡µé¢
  @Builder
  buildCameraPage() {
    MqttClientPanel()
      .height('80%')
    // Column({ space: 10 }) {
    //   Text('æ‹ç…§ä¸Šä¼ ')
    //     .fontSize(22)
    //     .fontWeight(FontWeight.Medium)
    //
    //   Button('æ‹ç…§')
    //     .width('80%')
    //     .height(45)
    //     .fontSize(18)
    //     .onClick(() => this.takePhoto())
    //
    //   if (this.capturedImage != null) {
    //     Image(this.capturedImage)
    //       .width('80%')
    //       .height(200)
    //       .objectFit(ImageFit.Cover)
    //       .borderRadius(10)
    //       .margin({ top: 10 })
    //   } else {
    //     Text('æœªæ‹æ‘„ç…§ç‰‡')
    //       .fontSize(16)
    //       .fontColor(Color.Grey)
    //   }
    // }
    // .justifyContent(FlexAlign.Center)
    // .alignItems(HorizontalAlign.Center)
  }

  // å…¶ä»–æ¨¡å—é¡µé¢
  @Builder
  buildPlaceholderPage(title: string) {
    Column() {
      Text(title)
        .fontSize(22)
        .fontWeight(FontWeight.Medium)
      Text('è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...')
        .fontColor(Color.Grey)
        .fontSize(16)
        .margin({ top: 10 })
    }
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .height('100%')
  }

  // åº•éƒ¨å¯¼èˆªæŒ‰é’®
  @Builder
  buildNavButton(title: string, icon: string) {
    Column() {
      Text(icon).fontSize(20)
      Text(title)
        .fontSize(14)
        .fontColor(this.selectedTab === title ? '#4CAF50' : Color.Black) // é€‰ä¸­ç»¿è‰²
    }
    .onClick(() => {
      this.selectedTab = title
    })
  }
}
